# Run a cafe

Anyone can run a Textile peer as a _cafe_ and start issuing backup and messaging services to the network. You do not need to rely on Textile's cafe network, or anyone else's network for that matter.

To run your node in cafe mode you need to edit the config found at `.textile/repo/textile`, or use the built-in `config` (see [Config](/learn/config)) commands, or specify custom cafe options on node init (see `textile init --help` and/or the [[Daemon|Daemon]] wiki entry). If you've already installed `go-textile` and used the default settings, your config file will be in your `HOME` directory. You'll need to edit the `Cafe` entry (see also the [`Cafe` section of the [config](/learn/config#Cafe)). You'll just change the field `"Open": false` to `"Open": true`, restart your daemon and you are off to the races!

More advanced cafe settings and setup allows developers to fine-tune how their cafe interacts with Textile peers, what services they provide, how those services are accessed (and where), and even setup access control and other tweaks. Textile uses several 'default' settings for our cafes, whose setup scripts are available from our [`textile-opts` GitHub repository](https://github.com/textileio/textile-opts). For example, Textile cafes are all run using the _server_ IPFS profile, with their cafe APIs bound to `0.0.0.0:40601`, their Gateway address bound to `0.0.0.0:5050`, and swarming on port `4001`. We also use a `systemctl` service to keep the peers running on reboot. For actual cafe instances, Textile uses a series of Amazon EC2 instances, each behind its own load balancer to facilitate SSL certificate setup and handling. Additionally, all of Textile's cafes' decrypting gateways are tied together via a different load balancer to provide a 'logically centralized' access point for Gateway services. This setup is by no means required, and while your particular use cases may differ, we provide this information for those looking to setup their own cafe arrangement in a 'production' environment.

## Docker

Textile provides `-cafe` tagged Docker images with a Textile peer configured as a cafe. See all available tags [here](https://hub.docker.com/r/textile/go-textile/tags).

    $ docker run -it --name textile-cafe-node \
      -p 4001:4001 -p 8081:8081 -p 5050:5050 -p 127.0.0.1:40600:40600 -p 40601:40601 \
      -e CAFE_HOST_URL=<public_URL> -e CAFE_HOST_PUBLIC_IP=<public_IP> \
      textile/go-textile:latest-cafe

A cafe node can issue client sessions (JWTs) to other nodes. In order to issue valid sessions, the cafe must know its public IP address and the machine's public facing URL. The `CAFE_HOST_PUBLIC_IP` and `CAFE_HOST_URL` environment variable values are written to the textile config file. Read more about cafe host config settings [here](/learn/config#Cafe).

## Registering with a cafe

To add a new cafe, you can use the `textile cafes add` command. This will register your local peer with the given cafe peer, and saves an expiring service session token. An access token is required for initial registration, and should be obtained separately from the target cafe. The command to add a new cafe looks something like this: `textile cafes add --token=blahblahblahblahblahnlahblah https://textile.cafe` where the `token` argument is a token, as generated by the `textile tokens create` command (again, you'll have to obtain this from a cafe administrator) and the URL is the public address of the running cafe (see [Running a cafe](/run/cafes) for details).

Once you have registered with a cafe, you can list them `textile cafes ls`, get information on a particular cafe (`textile cafes get`), and even remove them from your list (`textile cafes rm`). Additionally, you can manually check for offline messages using `textile cafes messages`. However, this is done automatically every 30 seconds or so.

If you add multiple cafes, your content will be duplicated across each one.
